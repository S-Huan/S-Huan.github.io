<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>前端技巧合集（一）</title>
      <link href="/2023/01/06/%E5%89%8D%E7%AB%AF%E6%8A%80%E5%B7%A7%E5%90%88%E9%9B%86%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2023/01/06/%E5%89%8D%E7%AB%AF%E6%8A%80%E5%B7%A7%E5%90%88%E9%9B%86%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h3 id="通用方法集"><a href="#通用方法集" class="headerlink" title="通用方法集"></a>通用方法集</h3><h4 id="yarn-serve-build-不启动解决方案"><a href="#yarn-serve-build-不启动解决方案" class="headerlink" title="yarn serve / build 不启动解决方案"></a>yarn serve / build 不启动解决方案</h4><ul><li>主要原因是没有在package.json里面的scripts,属性里设置，快捷访问<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">&quot;serve&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-cli-service serve&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line"><span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-cli-service serve&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line"><span class="attr">&quot;build:prod&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-cli-service build&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="vue网站名称修改"><a href="#vue网站名称修改" class="headerlink" title="vue网站名称修改"></a>vue网站名称修改</h4><ul><li>在vue.config.js配置文件里</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">configureWebpack</span>: &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// provide the app&#x27;s title in webpack&#x27;s name field, so that</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// it can be accessed in index.html to inject the correct title.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">name</span>: name,</span><br><span class="line"></span><br><span class="line"><span class="attr">resolve</span>: &#123;</span><br><span class="line"></span><br><span class="line"><span class="attr">alias</span>: &#123;</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;@&#x27;</span>: <span class="title function_">resolve</span>(<span class="string">&#x27;src&#x27;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="vue里本地访问端口修改"><a href="#vue里本地访问端口修改" class="headerlink" title="vue里本地访问端口修改"></a>vue里本地访问端口修改</h4><ul><li><p>webpack修改本地访问端口，在webpack的配置文件config里。但是vue本身就是webpack封装的，所以在vue.config.js的devServe属性里。</p></li><li><p>有两个文件.env.development / .env.production 是环境变量的配置文件。可以在这两个文件里直接设置变量。可以用 process.env.变量名的方式引用（具体引用那个环境变量，取决于启动的模式）。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> port = process.<span class="property">env</span>.<span class="property">port</span> || process.<span class="property">env</span>.<span class="property">npm_config_port</span></span><br><span class="line"></span><br><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line"></span><br><span class="line"><span class="attr">port</span>: port,</span><br><span class="line"></span><br><span class="line"><span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line"><span class="attr">overlay</span>: &#123;</span><br><span class="line"></span><br><span class="line"><span class="attr">warnings</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line"><span class="attr">errors</span>: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="怎么给node降级？"><a href="#怎么给node降级？" class="headerlink" title="怎么给node降级？"></a>怎么给node降级？</h4><ol><li>安装node版本管理模块n</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install n -g</span><br></pre></td></tr></table></figure><ol><li>安装稳定版<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo n stable</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>安装最新版</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo n latest</span><br></pre></td></tr></table></figure></li><li><p>版本降级/升级</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo n 版本号     //例如：sudo n 9.1.7</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h4 id="怎么解构变量"><a href="#怎么解构变量" class="headerlink" title="- 怎么解构变量"></a>- 怎么解构变量</h4><ul><li>通过解构变量，获得数据对象深层的数据</li><li>一般获取的数据最外层就是data，所以其实第二层的data才是获取对象里面的data属性<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">getCatagtory</span>(<span class="params">context</span>)&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;<span class="attr">data</span>: &#123;<span class="attr">data</span>: &#123; channels &#125;&#125;&#125; = <span class="keyword">await</span> </span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">&#x27;http://ttapi.research.itcast.cn/app/v1_0/channels&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="rem适配方法"><a href="#rem适配方法" class="headerlink" title="- rem适配方法"></a>- rem适配方法</h4><ul><li>[[头条-移动端#移动端 REM 适配|postcss-pxtorem]] 是一款 PostCSS 插件，用于将 px 单位转化为 rem 单位</li><li>lib-flexible 用于设置 rem 基准值<blockquote><p>两个相互配合，一个设置基准值，基准值根据宽度的十分之一变化，然后把px转化为rem，rem因为前面都随宽度变化了，所有所有的px也都是随着宽度的变化而变化。</p></blockquote></li></ul><p>注意：行内样式的px不能转化为rem。</p><h4 id="git拒绝推送问题"><a href="#git拒绝推送问题" class="headerlink" title="- git拒绝推送问题"></a>- git拒绝推送问题</h4><ul><li><p>原因：在网页进行了push提交动作。</p></li><li><p>解决方法一：强行上传</p></li></ul><p>强制上传输入命令： git push -u origin +master</p><ul><li>解决方法二：先拉取后推送<br>先同步git/github上的代码到本地，在上面更改将内容进行合并后再上传</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git fetch origin https://github.com/yhlleo/myGitTest.git</span><br><span class="line"> </span><br><span class="line">git merge origin/master //获取远程更新</span><br><span class="line"> </span><br><span class="line">git push origin master  //把更新的内容合并到本地分支</span><br></pre></td></tr></table></figure><h4 id="怎么关闭代码检查"><a href="#怎么关闭代码检查" class="headerlink" title="- 怎么关闭代码检查"></a>- 怎么关闭代码检查</h4><ul><li>关闭-进入vue.config.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  <span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="comment">// ...其他配置</span></span><br><span class="line">    <span class="attr">lintOnSave</span>: <span class="literal">false</span> <span class="comment">// 关闭eslint检查</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//重启服务器</span></span><br></pre></td></tr></table></figure><h4 id="AXISO请求拦截器设置token"><a href="#AXISO请求拦截器设置token" class="headerlink" title="-  AXISO请求拦截器设置token"></a>-  AXISO请求拦截器设置token</h4><blockquote><p>设置请求拦截器可以不用再封装token，请求时候请求拦截器可以自动携带</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给要发送请求的模块设置拦截器</span></span><br><span class="line">request.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">config</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do something before request is sent</span></span><br><span class="line"><span class="comment">//config是本次请求的请求配置对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;user&#125; = store.<span class="property">state</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(user &amp;&amp; user.<span class="property">token</span>)&#123;</span><br><span class="line"></span><br><span class="line">config.<span class="property">headers</span>.<span class="property">Authorization</span> = <span class="string">`Bearer <span class="subst">$&#123;user.token&#125;</span>`</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> config;</span><br><span class="line"></span><br><span class="line">&#125;, <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do something with request error</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></blockquote></li></ul><h4 id="axiso接收拦截器"><a href="#axiso接收拦截器" class="headerlink" title="- axiso接收拦截器"></a>- axiso接收拦截器</h4><p>![[image-20200812020656210.png]]<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line"></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// axios默认加了一层data</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; success, message, data &#125; = response.<span class="property">data</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 要根据success的成功与否决定下面的操作</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (success) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 业务已经错误了 还能进then ? 不能 ！ 应该进catch</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Message</span>.<span class="title function_">error</span>(message) <span class="comment">// 提示错误消息</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(message))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;, <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Message</span>.<span class="title function_">error</span>(error.<span class="property">message</span>) <span class="comment">// 提示错误信息</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error) <span class="comment">// 返回执行错误 让当前的执行链跳出成功 直接进入 catch</span></span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><h4 id="scoped模式"><a href="#scoped模式" class="headerlink" title="- scoped模式"></a>- scoped模式</h4><blockquote><p>想要解决这个问题，就要添加deep属性,因为这个模式不能改变引入样式的子级样式，需要加deep,但是根样式还是可以改变的</p></blockquote><ol><li>第一种：加上父级自己定义的类名<code>.common-container &gt;&gt;&gt;</code> （只作用于css）</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.common-container &gt;&gt;&gt; .van-pull-refresh__head &#123;</span><br><span class="line">  color: #fff;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol><li>第二种：有些Sass 、Less之类的预处理器无法正确解析 <code>&gt;&gt;&gt;</code>。可以使用 <code>/deep/</code>操作符或 <code>::v-deep</code> 操作符( 两者都是<code>&gt;&gt;&gt;</code> 的别名)</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">/deep/ .van-list__error-text, </span><br><span class="line">/deep/ .van-list__finished-text,  </span><br><span class="line">/deep/ .van-list__loading ,</span><br><span class="line">/deep/ .van-pull-refresh__head ,</span><br><span class="line">/deep/ .van-loading__text &#123;</span><br><span class="line">  color: #fff;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.common-container&#123;</span><br><span class="line">    &amp;::v-deep .van-pull-refresh__head&#123;</span><br><span class="line">     color: #fff;</span><br><span class="line">        // ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="Referer-请求头怎么取消"><a href="#Referer-请求头怎么取消" class="headerlink" title="-  Referer 请求头怎么取消"></a>-  Referer 请求头怎么取消</h4><blockquote><p>Referer 是 HTTP 请求头的一部分，当浏览器向 Web 服务器发送请求的时候，一般会带上 Referer，它包含了当前请求资源的来源页面的地址。服务端一般使用 Referer 请求头识别访问来源，可能会以此进行统计分析、日志记录以及缓存优化等。</p><ul><li>停止referer请求头</li><li><code>&lt;a&gt;</code>、<code>&lt;area&gt;</code>、<code>&lt;img&gt;</code>、<code>&lt;iframe&gt;</code>、<code>&lt;script&gt;</code> 或者 <code>&lt;link&gt;</code> 元素上的 <code>referrerpolicy</code> 属性为其设置独立的请求策略，例如：</li></ul></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://……&quot;</span> <span class="attr">referrerPolicy</span>=<span class="string">&quot;no-referrer&quot;</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>或者直接在 HTMl 页面头中通过 meta 属性全局配置：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;referrer&quot;</span> <span class="attr">content</span>=<span class="string">&quot;no-referrer&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Day-js时间第三方库"><a href="#Day-js时间第三方库" class="headerlink" title="-  Day.js时间第三方库"></a>-  Day.js时间第三方库</h4><blockquote><p>Day.js是一个极简的JavaScript库，可以为现代浏览器解析、验证、操作和显示日期和时间。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install dayjs --save</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">&#x27;dayjs&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dayjs/locale/zh-cn&#x27;</span></span><br><span class="line"></span><br><span class="line">dayjs.<span class="title function_">locale</span>(<span class="string">&#x27;zh-cn&#x27;</span>)  <span class="comment">//全局注册</span></span><br></pre></td></tr></table></figure><h4 id="Lodash-JS工具函数库"><a href="#Lodash-JS工具函数库" class="headerlink" title="- Lodash-JS工具函数库"></a>- Lodash-JS工具函数库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save lodash</span><br></pre></td></tr></table></figure><ol><li>防抖函数</li></ol><ul><li>按需加载需要的工具函数<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_.<span class="title function_">debounce</span>(func, [wait=<span class="number">0</span>], [options=])</span><br><span class="line"><span class="comment">//debounce(业务函数， 等待时间， 可选项)</span></span><br></pre></td></tr></table></figure></li></ul><p>==example<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">debounce</span>( <span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">val</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> <span class="title function_">getSearchSuggestions</span>(val)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">suggestions</span> = data.<span class="property">data</span>.<span class="property">options</span></span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">catch</span>(err)&#123;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.$toast(<span class="string">&#x27;获取推荐失败&#x27;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">&#125;, <span class="number">1000</span>),</span><br></pre></td></tr></table></figure></p><h4 id="js里的数字大小受限问题"><a href="#js里的数字大小受限问题" class="headerlink" title="- js里的数字大小受限问题"></a>- js里的数字大小受限问题</h4><blockquote><p>用json-bigint第三方包,可以解决js处理数据只能识别 2^52的整数</p></blockquote><ol><li><p>安装</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add json-bigint</span><br></pre></td></tr></table></figure></li><li><p>在axios请求模块中引入</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">JSON</span>Big <span class="keyword">from</span> <span class="string">&#x27;json-bigint&#x27;</span></span><br></pre></td></tr></table></figure></li></ol><ul><li>JSONBig方法</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这个方法会把超出安全范围的数字封装在bignumber的对象里，想要用的话，就把这个对象.tostring(),转为字符串就可以正确显示了。  </span></span><br><span class="line"><span class="title class_">JSON</span>Big.<span class="title function_">parse</span>() <span class="comment">//JSON字符串转成js对象  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//用 JSONBig.parse() 转的js对象，一定要用JSON.Big.Stringify() 转回JSON字符串</span></span><br><span class="line"><span class="title class_">JSON</span>Big.<span class="title class_">Stringify</span>()<span class="comment">//js对象转成JSON字符串</span></span><br></pre></td></tr></table></figure><ol><li>在axios请求模块中添加配置： 改变接收原始数据的方法<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line"></span><br><span class="line"><span class="attr">baseURL</span>: <span class="string">&#x27;http://toutiao.itheima.net/&#x27;</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">//在请求模块拦截接收的数据，手动用JSONBig转换接收的JSON字符串（默认会给我们用json.parse()的方法）</span></span><br><span class="line"><span class="attr">transformResponse</span>: [<span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do whatever you want to transform the data</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title class_">JSON</span>Big.<span class="title function_">parse</span>(data)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;]</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ol><ul><li>小问题： 非安全数字转为js对象时，会被封装成bignumber对象，所以有时要用tostring转换</li><li>但是，比如拼接字符串时，会自动把对象转换为字符串，所以不用转换，比如url拼接.</li></ul><h4 id="less自动导入全局样式问题"><a href="#less自动导入全局样式问题" class="headerlink" title="less自动导入全局样式问题"></a>less自动导入全局样式问题</h4><ul><li>在当前项目下执行一下命令<code>vue add style-resources-loader</code>，添加一个vuecli的插件</li><li>安装完毕后会在<code>vue.config.js</code>中自动添加配置，如下：</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">pluginOptions</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;style-resources-loader&#x27;</span>: &#123;</span><br><span class="line">      <span class="attr">preProcessor</span>: <span class="string">&#x27;less&#x27;</span>,</span><br><span class="line">      <span class="attr">patterns</span>: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>把你需要注入的文件配置一下后，重启服务即可。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+<span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)  <span class="comment">//比拼接好，会解析../../</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">pluginOptions</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;style-resources-loader&#x27;</span>: &#123;</span><br><span class="line">      <span class="attr">preProcessor</span>: <span class="string">&#x27;less&#x27;</span>,</span><br><span class="line">      <span class="attr">patterns</span>: [</span><br><span class="line">+        path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;./src/assets/styles/variables.less&#x27;</span>),</span><br><span class="line">+        path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;./src/assets/styles/mixins.less&#x27;</span>)</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>总结：</strong> 知道如何定义less变量和混入代码并使用他们，通过vue-resources-loader完成代码注入再每个less文件和vue组件中。</p><h4 id="公共样式的重置插件"><a href="#公共样式的重置插件" class="headerlink" title="公共样式的重置插件"></a>公共样式的重置插件</h4><p>执行 <code>npm i normalize.css</code> 安装重置样式的包，然后在 <code>main.js</code> 导入 <code>normalize.css</code> 即可。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"></span><br><span class="line">+<span class="keyword">import</span> <span class="string">&#x27;normalize.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">use</span>(store).<span class="title function_">use</span>(router).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="图片转为base64"><a href="#图片转为base64" class="headerlink" title="图片转为base64"></a>图片转为base64</h4><ul><li>需要配置10kb下的图片打包成base64的格式 <code>vue.config.js</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">chainWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">  config.<span class="property">module</span></span><br><span class="line">    .<span class="title function_">rule</span>(<span class="string">&#x27;images&#x27;</span>)</span><br><span class="line">    .<span class="title function_">use</span>(<span class="string">&#x27;url-loader&#x27;</span>)</span><br><span class="line">    .<span class="title function_">loader</span>(<span class="string">&#x27;url-loader&#x27;</span>)</span><br><span class="line">    .<span class="title function_">tap</span>(<span class="function"><span class="params">options</span> =&gt;</span> <span class="title class_">Object</span>.<span class="title function_">assign</span>(options, &#123; <span class="attr">limit</span>: <span class="number">10000</span> &#125;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="当vue的-事件获取不同参数的方法？"><a href="#当vue的-事件获取不同参数的方法？" class="headerlink" title="当vue的@事件获取不同参数的方法？"></a>当vue的@事件获取不同参数的方法？</h4><ul><li><p>当我们的@事件()想要传参时， 有时参数在组件里面，需要@事件 = 事件名 获取， 又想要组件外的参数， 用@事件 = 事件名() 获取。 怎么同时获取呢?</p></li><li><p>通过箭头函数的方法，可以得到组件外的参数，也可以用$event获得组件里面传出来的参数。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">XtxCheckbox</span> @<span class="attr">change</span>=<span class="string">&quot;($event) =&gt; checkOne(good.skuId, $event)&quot;</span> <span class="attr">:modelValue</span>=<span class="string">&quot;good.selected&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="mock数据"><a href="#mock数据" class="headerlink" title="mock数据"></a>mock数据</h4><blockquote><p>从 1.0 开始，Mock.js 通过覆盖和模拟原生 XMLHttpRequest 的行为来拦截 Ajax 请求，不再依赖于第三方 Ajax 工具库（例如 jQuery、Zepto 等）。<br>![[Pasted image 20221122213131.png]]</p><p><code>mockjs</code>可以模拟可更快的得到较为真实的数据，且可以拦截axios的接口调用<br>就是按照正常的方式请求数据， 然后mock可以拦截我们发出去的请求替换为mock数据</p></blockquote><ol><li><p>配置 <code>src/mock/index.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Mock</span> <span class="keyword">from</span> <span class="string">&#x27;mockjs&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// mock的配置</span></span><br><span class="line"><span class="title class_">Mock</span>.<span class="title function_">setup</span>(&#123;</span><br><span class="line">  <span class="comment">// 随机延时500-1000毫秒  模拟网络延迟</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="string">&#x27;500-1000&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>使用 <code>src/main.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./mock&#x27;</span>  <span class="comment">//先使用mock</span></span><br></pre></td></tr></table></figure></li><li><p>模拟接口，拦截请求</p></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Mock</span> <span class="keyword">from</span> <span class="string">&#x27;mockjs&#x27;</span></span><br><span class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">&#x27;qs&#x27;</span></span><br><span class="line"><span class="comment">// 拦截请求，</span></span><br><span class="line"><span class="comment">// 第一个参数：url，使用正则去匹配</span></span><br><span class="line"><span class="comment">// 第二个参数：请求方式</span></span><br><span class="line"><span class="comment">// 第三个参数： 生成模拟数据模板（可以是字符串、对象、数组、或者函数返回数据）</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Mock</span>.<span class="title function_">mock</span>(<span class="regexp">/\/member\/collect/</span>, <span class="string">&#x27;get&#x27;</span>, <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> queryString = config.<span class="property">url</span>.<span class="title function_">split</span>(<span class="string">&#x27;?&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> queryObject = qs.<span class="title function_">parse</span>(queryString)  <span class="comment">//qc 解析模板字符串为对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> items = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; +queryObject.<span class="property">pageSize</span>; i++) &#123;  <span class="comment">//模拟pageSize条数据</span></span><br><span class="line"></span><br><span class="line">items.<span class="title function_">push</span>(<span class="title class_">Mock</span>.<span class="title function_">mock</span>(&#123;</span><br><span class="line"></span><br><span class="line"><span class="attr">id</span>: <span class="string">&#x27;@id&#x27;</span>,</span><br><span class="line"></span><br><span class="line"><span class="attr">name</span>: <span class="string">&#x27;@ctitle(10,20)&#x27;</span>,</span><br><span class="line"></span><br><span class="line"><span class="attr">desc</span>: <span class="string">&#x27;@ctitle(4,10)&#x27;</span>,</span><br><span class="line"></span><br><span class="line"><span class="attr">price</span>: <span class="string">&#x27;@float(100,200,2,2)&#x27;</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// http://zhoushugang.gitee.io/erabbit-client-pc-static/uploads/clothes_goods_7.jpg</span></span><br><span class="line"></span><br><span class="line"><span class="attr">picture</span>: <span class="string">`http://zhoushugang.gitee.io/erabbit-client-pc-static/uploads/clothes_goods_<span class="subst">$&#123;Mock.mock(<span class="string">&#x27;@integer(1,8)&#x27;</span>)&#125;</span>.jpg`</span></span><br><span class="line"></span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="attr">msg</span>: <span class="string">&#x27;获取收藏商品成功&#x27;</span>,</span><br><span class="line"></span><br><span class="line"><span class="attr">result</span>: &#123;</span><br><span class="line"></span><br><span class="line"><span class="attr">counts</span>: <span class="number">35</span>,</span><br><span class="line"></span><br><span class="line"><span class="attr">pageSize</span>: +queryObject.<span class="property">pageSize</span>,</span><br><span class="line"></span><br><span class="line"><span class="attr">page</span>: +queryObject.<span class="property">page</span>,</span><br><span class="line"></span><br><span class="line">items</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//config可以接收前端返回来的数据， body， type， url， 注意， get发送的query在url上， 需要解析成对象才能使用， node中有一个内置函数qc， 可以解析模板字符串</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li>占位符- 随机数</li></ol><ul><li>在模拟的数据模板中， 可能需要随机写入预设好的模板，官方预设了一些占位符， 可以快速写入模拟数据</li><li>但是需要Mock.mock()才能触发， 所以想要使用， 需要在函数里面返回<code>Mock.mock()</code>返回的结果<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title class_">Mock</span>.<span class="title function_">mock</span>(<span class="string">&#x27;@CONSTELLATION&#x27;</span>)</span><br><span class="line"><span class="comment">// =&gt; &quot;天蝎座&quot;</span></span><br><span class="line"><span class="title class_">Mock</span>.<span class="title function_">mock</span>(&#123;</span><br><span class="line">    <span class="attr">constellation</span>: <span class="string">&#x27;@CONSTELLATION&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="编辑器第三方库"><a href="#编辑器第三方库" class="headerlink" title="编辑器第三方库"></a>编辑器第三方库</h4></li></ul><p>组件依赖：<a href="https://www.wangeditor.com/">wangEditor</a></p><p>安装依赖： <code>npm i wangeditor --save</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> 前端技巧 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自动生成骨架屏方案</title>
      <link href="/2022/12/17/%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E9%AA%A8%E6%9E%B6%E5%B1%8F%E6%96%B9%E6%A1%88%20copy/"/>
      <url>/2022/12/17/%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E9%AA%A8%E6%9E%B6%E5%B1%8F%E6%96%B9%E6%A1%88%20copy/</url>
      
        <content type="html"><![CDATA[<p>今天的分享主要分为三个部分：</p><ul><li>首屏加载状态演进</li><li>如何构建骨架屏</li><li>将骨架屏打包的项目中</li></ul><h2 id="首屏加载的演进"><a href="#首屏加载的演进" class="headerlink" title="首屏加载的演进"></a>首屏加载的演进</h2><p>我们先来看一些权威机构所做的研究报告。</p><p>一份是 Akamai 的研究报告，当时总共采访了大约 1048 名网上购物者，得出了这样的结论：</p><p>大约有 47% 的用户期望他们的页面在两秒之内加载完成。</p><p>如果页面加载时间超过 3s，大约有 40% 的用户选择离开或关闭页面。</p><p>这是 TagMan 和眼镜零售商 Glasses Direct 合作进行的测试，研究页面加载速度和最终转化率的关系：</p><p>在这份测试报告中，发现了网页加载速度和转化率呈现明显的负相关性，在页面加载时间为1~2 秒时的转化率是最高的，而当加载时间继续增长，转化率开始呈现一个下降的趋势，大约页面加载时间每增加 1s 转化率下降6.7个百分点。</p><p>另外一份研究报告是 MIT 神经科学家在 2014 年做的研究，人类可以在 13ms 内感知到离散图片的存在，并将图片的大概信息传输到我们的大脑中，在接下来的 100 到 140ms 之间，大脑会决定我们的眼睛具体关注图片的什么位置，也就是获取图片的关注焦点。从另一个角度来看，如果用户进行某项交互（比如点击某按钮），要让用户感知不到延迟或者数据加载，我们大概有 200 ms 的时间来准备新的界面信息呈现给用户。</p><p>在 200ms 到 1s 之间，用户似乎还感知不到自己处在交互等待状态，当一秒钟后依然得不到任何反馈，用户将会把其关注的焦点移到其他地方，如果等待超过 10s，用户将对网站失去兴趣，并浏览其他网站。</p><p>那么我们需要做些什么来留住用户呢？</p><p>通常方案，我们会在首屏、或者获取数据时，在页面中展现一个进度条，或者转动的 Spinner。</p><ul><li><p>进度条：明确知道交互所需时间，或者知道一个大概值的时候我们选择使用进度条。</p></li><li><p>Spinner：无法预测获取数据、或者打开页面的时长。</p></li></ul><p>有了进度条或者 Spinner，至少告诉了用户两点内容：</p><ul><li><p>你所进行的操作需要等待一段时间。</p></li><li><p>其次，安抚用户，让其耐心等待。</p></li></ul><p>除此之外，进度条和 Spinner 并不能带来其他任何作用，既无法让用户感知到页面加载得更快，也无法给用户一个焦点，让用户将关注集中到这个焦点上，并且知道这个焦点即将呈现用户感兴趣的内容。</p><p>那么有没有比进度条和 Spinner 更好的方案呢？也许我们需要的是骨架屏。</p><p>其实，骨架屏（Skeleton Screen）已经不是什么新奇的概念了，Luke Wroblewski 早在 2013 年就首次提出了骨架屏的概念，并将这一概念成功得运用到他当时的产品「Polar app」中，2014 年，「Polar」加入 Google，Luke Wroblewski 本人也成为了Google 的一位产品总监。</p><p>A skeleton screen is essentially a blank version of a page into which information is gradually loaded.</p><p>他是这样定义骨架屏的，他认为骨架屏是一个页面的空白版本，通过这个空白版本传递信息，我们的页面正在渐进式的加载过程中。</p><p>苹果公司已经将骨架屏写入到了 iOS Human Interface Guidelines ,只是在该手册中，其用了一个新的概念「launch images」。在该手册中，其推荐在应用首屏中包含文本或者元素基本的轮廓。</p><p>2015 年，Facebook 也首次在其移动端 App 中使用了骨架屏的设计来预览页面的加载状态。</p><p>随后，Twitter，Medium，YouTube 也都在其产品设计中添加了骨架屏，骨架屏一时成为了首屏加载的新趋势，国内一些公司也紧随其后，饿了么、知乎、掘金、腾讯新闻等也都在其 PC 端或者移动端加入了骨架屏设计。</p><h2 id="为什么需要骨架屏？"><a href="#为什么需要骨架屏？" class="headerlink" title="为什么需要骨架屏？"></a>为什么需要骨架屏？</h2><p>在最开始关于 MIT 2014 年的研究中已有提到，用户大概会在 200ms 内获取到界面的具体关注点，在数据获取或页面加载完成之前，给用户首先展现骨架屏，骨架屏的样式、布局和真实数据渲染的页面保持一致，这样用户在骨架屏中获取到关注点，并能够预知页面什么地方将要展示文字什么地方展示图片，这样也就能够将关注焦点移到感兴趣的位置。当真实数据获取后，用真实数据渲染的页面替换骨架屏，如果整个过程在 1s 以内，用户几乎感知不到数据的加载过程和最终渲染的页面替换骨架屏，而在用户的感知上，出现骨架屏那一刻数据已经获取到了，而后只是数据渐进式的渲染出来。这样用户感知页面加载更快了。</p><p>再看看现在的前端框架， React 、Vue 、Angular 已经占据了主导地位，市面上大多数前端应用也都是基于这三个框架或库完成，这三个框架有一个共同的特点，都是 JS 驱动，在 JS 代码解析完成之前，页面不会展示任何内容，也就是所谓的白屏。用户是极其不喜欢看到白屏的，什么都没有展示，用户很有可能怀疑网络或者应用出了什么问题。 拿 Vue 来说，在应用启动时，Vue 会对组件中的 data 和 computed 中状态值通过 Object.defineProperty 方法转化成 set、get 访问属性，以便对数据变化进行监听。而这一过程都是在启动应用时完成的，这也势必导致页面启动阶段比非 JS 驱动（比如 jQuery 应用）的页面要慢一些。</p><h2 id="如何构建骨架屏"><a href="#如何构建骨架屏" class="headerlink" title="如何构建骨架屏"></a>如何构建骨架屏</h2><p>饿了么移动 web 页面在 2016 年开始引入骨架屏，是完全通过 HTML 和 CSS 手写的，手写骨架屏当然可以完全复刻页面的真实样式，但也有弊端：</p><p>举个例子，突然有一天，产品经理跑到了我面前，这个页面布局需要调整一下，然后这一块推广内容可以去掉了，我当时的心情可能是这样的。</p><p>手写骨架屏带来的问题就是，每次需求的变更我们不仅需要修改业务代码， 同时也要去修改骨架屏的样式和布局，这往往是比较机械重复的工作，手写骨架屏增加了维护成本。</p><p>因此饿了么前端团队一直在寻找一种更好、更快的将数据呈现到用户面前的方案。</p><p>在选择骨架屏之前，我们也调研了其他两种备选方案：服务端渲染（ssr）和预渲染（prerender）。</p><p>现在，前端领域，不同框架下，服务端渲染的技术已经相当成熟，开箱即用的方案也有，比如 Vue 的 Nuxt.js。那么为什么不直接使用服务端渲染来加快内容展现？</p><p>首先我们了解到，服务端渲染主要有两个目的，一是 SEO，二是加快内容展现。在带来这两个好处的同时，我们也需要评估服务端渲染的成本，首先我们需要服务端的支持，因此涉及到了到了服务构建、部署等，同时我们的 web 项目是一个流量较大的网站，也需要考虑服务器的负载，以及相应的缓存策略，特别是一些外卖行业，由于地理位置的不同，不同用户看到的页面也是不一样的，也就是所谓的千人千面，这也为缓存造成了一定困难。</p><p>其次，预渲染（prerender），所谓预渲染，就是在项目的构建过程中，通过一些渲染机制，比如 puppeteer 或则 jsdom 将页面在构建的过程中就渲染好，然后插入到 html 中，这样在页面启动之前首先看到的就是预渲染的页面了。但是该方案最终也抛弃了，预渲染渲染的页面数据是在构建过程中就已经打包到了 html 中， 当真实访问页面的时候，真实数据可能已经和预渲染的数据有了很大的出入，而且预渲染的页面也是一个不可交互的页面，在页面没有启动之前，用户无法和预渲染的页面进行任何交互，预渲染页面中的数据反而会影响到用户获取真实的信息，当涉及到一些价格、金额、地理位置的地方甚至会导致用户做出一些错误的决定。因此我们最终没有选择预渲染方案。</p><h2 id="生成骨架屏基本方案"><a href="#生成骨架屏基本方案" class="headerlink" title="生成骨架屏基本方案"></a>生成骨架屏基本方案</h2><p>通过 puppeteer 在服务端操控 headless Chrome 打开开发中的需要生成骨架屏的页面，在等待页面加载渲染完成之后，在保留页面布局样式的前提下，通过对页面中元素进行删减或增添，对已有元素通过层叠样式进行覆盖，这样达到在不改变页面布局下，隐藏图片和文字，通过样式覆盖，使得其展示为灰色块。然后将修改后的 HTML 和 CSS 样式提取出来，这样就是骨架屏了。</p><p>下面我将通过 page-skeleton-webpack-plugin 工具中的代码，来展示骨架屏的具体生成过程。</p><p>正如上面基本方案所描述的那样，我们将页面分成了不同的块：</p><ul><li><p>文本块：仅包含文本节点（NodeType 为 Node.TEXT_NODE）的元素（NodeType 为 Node.ELEMENT_NODE），一个文本块可能是一个 p 元素也可能是 div 等。文本块将会被转化为灰色条纹。</p></li><li><p>图片块：图片块是很好区分的，任何 img 元素都将被视为图片块，图片块的颜色将被处理成配置的颜色，形状也被修改为配置的矩形或者圆型。</p></li><li><p>按钮块：任何 button 元素、 type 为 button 的 input 元素，role 为 button 的 a 元素，都将被视为按钮块。按钮块中的文本块不在处理。</p></li><li><p>svg 块：任何最外层是 svg 的元素都被视为 svg 块。</p></li><li><p>伪类元素块：任何伪类元素都将视为伪类元素块，如 ::before 或者 ::after。</p></li><li><p>…</p></li></ul><p>首先，我们为什么要把页面划分为不同的块呢？</p><p>将页面划分为不同的块，然后分别对每个块进行处理，这样不会破坏页面整体的样式和布局，当我们最终生成骨架屏后，骨架屏的布局样式将和真实页面的布局样式完全一致，这样就达到了复用样式及页面布局的目的。</p><p>在所有分开处理之前，我们需要完成一项工作，就是将我们生成骨架屏的脚本，插入到 puppeteer 打开的页面中，这样我们才能够执行脚本，并最终生成骨架屏。</p><p>值得庆幸的是，puppeteer 在其生成的 page 实例中提供了一个原生的方法。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">page.<span class="title function_">addScriptTag</span>(options)</span><br><span class="line">  options&lt;<span class="title class_">Object</span>&gt;</span><br><span class="line">      url</span><br><span class="line">      path</span><br><span class="line">      content</span><br><span class="line">      type（<span class="title class_">Use</span> <span class="string">&#x27;module&#x27;</span> <span class="keyword">in</span> order to load a <span class="title class_">Javascript</span> <span class="title class_">ES6</span> <span class="variable language_">module</span>.）</span><br></pre></td></tr></table></figure><p>有了这种方法，我们可以插入一段 js 脚本的 url 或者是相对/绝对路径，也可以直接是 js 脚本的内容，在我们的实践过程中，我们直接插入的脚本内容。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">makeSkeleton</span>(<span class="params">page</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; defer &#125; = <span class="variable language_">this</span>.<span class="property">options</span></span><br><span class="line">  <span class="keyword">await</span> page.<span class="title function_">addScriptTag</span>(&#123; <span class="attr">content</span>: <span class="variable language_">this</span>.<span class="property">scriptContent</span> &#125;)</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">sleep</span>(defer)</span><br><span class="line">  <span class="keyword">await</span> page.evaluate(<span class="function">(<span class="params">options</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Skeleton</span>.<span class="title function_">genSkeleton</span>(options)</span><br><span class="line">  &#125;, <span class="variable language_">this</span>.<span class="property">options</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>有了上面插入的脚本，并且我们在脚本中提供了一个全局对象 Skeleton，这样我们就可以直接通过 page.evaluate 方法来执行脚本内容并最终生成骨架页面了。</p><p>由于时间有限，这儿不会对每个块的生成骨架结构进行详尽分析，这儿可能会重点阐述下文本块、图片块、svg 块如何生成骨架结构的，然后再谈谈如何对骨架结构进行优化。</p><h2 id="文本块的骨架结构生成"><a href="#文本块的骨架结构生成" class="headerlink" title="文本块的骨架结构生成"></a>文本块的骨架结构生成</h2><p>文本块可以算是骨架屏生成中最复杂的一个区块了，正如上面也说的，任何只包含文本节点的元素都将视为文本块，在确定某个元素是文本块后，下一步就是通过一些 CSS 样式，以及元素的增减将其修改为骨架样式。</p><p>在这张图中，图左边虚线框内是一个 p 元素，可以看到其内部有 4 行文本，右图是一个已经生成好的带有 4 行文本的骨架屏。在生成文本块骨架屏之前，我们首先需要了解一些基本的参数。</p><p>单行文本内容的高度，可以通过 fontSize 获取到。</p><p>单行文本内容加空白间隙的高度，可以通过 lineHeight 获取到。</p><p>p 元素总共有多少行文本，也就是所谓行数，这个可以通过 p 元素的 （height - paddingTop - paddingBottom）/ lineHeight 大概算出。</p><p>文本的 textAlign 属性。</p><p>在这些参数中，fontSize、lineHeight、paddingTop、paddingBottom 都可以通过 getComputedStyle 获取到，而元素的高度 height 可以通过 getBoundingClientRect 获取到，有了这些参数后我们就能够绘制文本块的骨架屏了。</p><p>相信很多人都读过 @Lea Verou 的 CSS Secrets 这本书，书中有一篇专门阐述怎么通过线性渐变生成条纹背景的文章，而在绘制文本块骨架屏方案，正是受到了这篇文章的启发，文本块的骨架屏也是通过线性渐变来绘制的。核心简化代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> textHeightRatio = <span class="built_in">parseFloat</span>(fontSize, <span class="number">10</span>) / <span class="built_in">parseFloat</span>(lineHeight, <span class="number">10</span>)</span><br><span class="line"><span class="keyword">const</span> firstColorPoint = ((<span class="number">1</span> - textHeightRatio) / <span class="number">2</span> * <span class="number">100</span>).<span class="title function_">toFixed</span>(decimal)</span><br><span class="line"><span class="keyword">const</span> secondColorPoint = (((<span class="number">1</span> - textHeightRatio) / <span class="number">2</span> + textHeightRatio) * <span class="number">100</span>).<span class="title function_">toFixed</span>(decimal)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rule = <span class="string">`&#123;</span></span><br><span class="line"><span class="string">  background-image: linear-gradient(</span></span><br><span class="line"><span class="string">    transparent <span class="subst">$&#123;firstColorPoint&#125;</span>%, <span class="subst">$&#123;color&#125;</span> 0%,</span></span><br><span class="line"><span class="string">    <span class="subst">$&#123;color&#125;</span> <span class="subst">$&#123;secondColorPoint&#125;</span>%, transparent 0%);</span></span><br><span class="line"><span class="string">  background-size: 100% <span class="subst">$&#123;lineHeight&#125;</span>;</span></span><br><span class="line"><span class="string">  position: <span class="subst">$&#123;position&#125;</span>;</span></span><br><span class="line"><span class="string">  background-origin: content-box;</span></span><br><span class="line"><span class="string">  background-clip: content-box;</span></span><br><span class="line"><span class="string">  background-color: transparent;</span></span><br><span class="line"><span class="string">  color: transparent;</span></span><br><span class="line"><span class="string">  background-repeat: repeat-y;</span></span><br><span class="line"><span class="string">&#125;`</span></span><br></pre></td></tr></table></figure><p>我们首先计算了 lineHeight 和 fontSize 等一些样式参数，通过这些参数我们计算出了文本占整个行高的比值，也就是 textHeightRadio，有了这一比值，就可以知道灰色条纹的分界点，正如 @Lea Verou 所说:</p><figure class="highlight plaintext"><figcaption><span>Secrets</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">“If a color stop has a position that is less than the specied position of any color stop before it in the list, set its position to be equal to the largest speci ed position of any color stop before it.”</span><br><span class="line">— CSS Images Level 3 (http://w3.org/TR/css3-images)</span><br></pre></td></tr></table></figure><p>也就是说，在线性渐变中，如果我们将线性渐变的起始点设置小于前一个颜色点的起始值，或者设置为0 %，那么线性渐变将会消失，取而代之的将是两条颜色分明的条纹，也就是说不再有线性渐变。</p><p>在我们绘制文本块的时候，backgroundSize 宽度为 100%， 高度为 lineHeight，也就是灰色条纹加透明条纹的高度是 lineHeight。虽然我们把灰色条纹绘制出来了，但是，我们的文字依然显示，在最终骨架样式效果出现之前，我们还需要隐藏文字，设置 color：‘transparent’ 这样我们的文字就和背景色一致，最终显示得也就是灰色条纹了。</p><p>根据 lineCount 我们可以判断文本块是单行文本还是多行，在处理单行文本的时候，由于文本的宽度并没有整行宽度，因此，针对单行文本，我们还需要计算出文本的宽度，然后设置灰色条纹的宽度为文本宽度，这样骨架样式的效果才能够更加接近文本样式。</p><p>图片块的骨架生成<br>图片块的绘制比文本块要相对简单很多，但是在订方案的过程中也踩了一些坑，这儿简单分享下采坑经历。</p><p>最初订的方案是通过一个 DIV 元素来替换 IMG 元素，然后设置 DIV 元素背景为灰色，DIV 的宽高等同于原来 IMG 元素的宽高，这种方案有一个严重的弊端就是，原来通过元素选择器设置到 IMG 元素上的样式无法运用到 DIV 元素上面，导致最终图片块的骨架效果和真实的图片在页面样式上有出入，特别是没法适配不同的移动端设备，因为 DIV 的宽高被硬编码。</p><p>接下来我们又尝试了一种看似「高级」的方法，通过 Canvas 来绘制和原来图片大小相同的灰色块，然后将 Canvas 转化为 dataUrl 赋予给 IMG 元素的 src 特性上，这样 IMG 元素就显示成了一个灰色块了，看似完美，当我们将生成的骨架页面生成 HTML 文件时，一下就傻眼了，文件大小尽然有 200 多 kb，我们做骨架页面渲染的一个重要原因就是希望用户在感知上感觉页面加载快了，如果骨架页面都有 200 多 kb，必将导致页面加载比之前要慢一些，违背了我们的初衷，因此该方案也只能够放弃。</p><p>最终方案，我们选择了将一张1 <em> 1 像素的 gif 透明图片，转化成 dataUrl ，然后将其赋予给 IMG 元素的 src 特性上，同时设置图片的 width 和 height 特性为之前图片的宽高，将背景色调至为骨架样式所配置的颜色值，完美解决了所有问题。<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 最小 1 * 1 像素的透明 gif 图片</span><br><span class="line">‘data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7’</span><br></pre></td></tr></table></figure><br>这是1 </em> 1像素的 base64 格式的图片，总共只有几十个字节，明显比之前通过 Canvas 绘制的图片小很多。</p><p>代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">imgHandler</span>(<span class="params">ele, &#123; color, shape, shapeOpposite &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; width, height &#125; = ele.<span class="title function_">getBoundingClientRect</span>()</span><br><span class="line">  <span class="keyword">const</span> attrs = &#123;</span><br><span class="line">    width,</span><br><span class="line">    height,</span><br><span class="line">    src</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> finalShape = shapeOpposite.<span class="title function_">indexOf</span>(ele) &gt; -<span class="number">1</span> ? <span class="title function_">getOppositeShape</span>(shape) : shape</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setAttributes</span>(ele, attrs)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> className = <span class="variable constant_">CLASS_NAME_PREFEX</span> + <span class="string">&#x27;image&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> shapeName = <span class="variable constant_">CLASS_NAME_PREFEX</span> + finalShape</span><br><span class="line">  <span class="keyword">const</span> rule = <span class="string">`&#123;</span></span><br><span class="line"><span class="string">    background: <span class="subst">$&#123;color&#125;</span> !important;</span></span><br><span class="line"><span class="string">  &#125;`</span></span><br><span class="line">  <span class="title function_">addStyle</span>(<span class="string">`.<span class="subst">$&#123;className&#125;</span>`</span>, rule)</span><br><span class="line">  <span class="title function_">shapeStyle</span>(finalShape)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">addClassName</span>(ele, [className, shapeName])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (ele.<span class="title function_">hasAttribute</span>(<span class="string">&#x27;alt&#x27;</span>)) &#123;</span><br><span class="line">    ele.<span class="title function_">removeAttribute</span>(<span class="string">&#x27;alt&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="svg-块骨架结构"><a href="#svg-块骨架结构" class="headerlink" title="svg 块骨架结构"></a>svg 块骨架结构</h2><p>svg 块处理起来也比较简单，首先我们需要判断 svg 元素 hidden 属性是否为 true，如果为 true，说明该元素不展示的，所以我们可以直接删除该元素。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (width === <span class="number">0</span> || height === <span class="number">0</span> || ele.<span class="title function_">getAttribute</span>(<span class="string">&#x27;hidden&#x27;</span>) === <span class="string">&#x27;true&#x27;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">removeElement</span>(ele)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果不是隐藏的元素，那么我们将会把 svg 元素内部所有元素删除，减少最终生成的骨架页面体积，其次，设置svg 元素的宽、高和形状等。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> shapeClassName = <span class="variable constant_">CLASS_NAME_PREFEX</span> + shape</span><br><span class="line"><span class="title function_">shapeStyle</span>(shape)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(ele.<span class="property">style</span>, &#123;</span><br><span class="line">  <span class="attr">width</span>: <span class="title function_">px2relativeUtil</span>(width, cssUnit, decimal),</span><br><span class="line">  <span class="attr">height</span>: <span class="title function_">px2relativeUtil</span>(height, cssUnit, decimal),</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">addClassName</span>(ele, [shapeClassName])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (color === <span class="variable constant_">TRANSPARENT</span>) &#123;</span><br><span class="line">  <span class="title function_">setOpacity</span>(ele)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> className = <span class="variable constant_">CLASS_NAME_PREFEX</span> + <span class="string">&#x27;svg&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> rule = <span class="string">`&#123;</span></span><br><span class="line"><span class="string">    background: <span class="subst">$&#123;color&#125;</span> !important;</span></span><br><span class="line"><span class="string">  &#125;`</span></span><br><span class="line">  <span class="title function_">addStyle</span>(<span class="string">`.<span class="subst">$&#123;className&#125;</span>`</span>, rule)</span><br><span class="line">  ele.<span class="property">classList</span>.<span class="title function_">add</span>(className)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="一些优化的细节"><a href="#一些优化的细节" class="headerlink" title="一些优化的细节"></a>一些优化的细节</h2><p>首先，由上面一些代码可以看出，在我们生成骨架页面的过程中，我们将所有的共用样式通过 addStyle 方法缓存起来，最后在生成骨架屏的时候，统一通过 style 标签插入到骨架屏中。这样保证了样式尽可能多的复用。<br>其次，在处理列表的时候，为了生成骨架屏尽可能美观，我们对列表进行了同化处理，也就是说将 list 中所有的 listItem 都是同一个 listItem 的克隆。这样生成的 list 的骨架屏样式就更加统一了。<br>还有就是，正如前文所说，骨架屏仅是一种加载状态，并非真实页面，因此其并不需要完整的页面，其实只需要首屏就好了，我们对非首屏的元素进行了删除，只保留了首屏内部元素，这样也大大缩减了生成骨架屏的体积。<br>删除无用的 CSS 样式，只是我们只提取了对骨架屏有用的 CSS，然后通过 style 标签引入。<br>关键代码大致是这样的：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">checker</span> = (<span class="params">selector</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable constant_">DEAD_OBVIOUS</span>.<span class="title function_">has</span>(selector)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/:-(ms|moz)-/</span>.<span class="title function_">test</span>(selector)) &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/:&#123;1,2&#125;(before|after)/</span>.<span class="title function_">test</span>(selector)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> keep = !!<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(selector)</span><br><span class="line">    <span class="keyword">return</span> keep</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="keyword">const</span> exception = err.<span class="title function_">toString</span>()</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Unable to querySelector(&#x27;<span class="subst">$&#123;selector&#125;</span>&#x27;) [<span class="subst">$&#123;exception&#125;</span>]`</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看出，我们主要通过 document.querySelector 方法来判断该 CSS 是否被使用到，如果该 CSS 选择器能够选择上元素，说明该 CSS 样式是有用的，保留。如果没有选择上元素，说明该 CSS 样式没有用到，所以移除。</p><p>在后面的一些 slides 中，我们来聊聊怎讲将构建骨架屏和 webpack 开发、打包结合起来，最终将我们的骨架屏打包到实际项目中。</p><h2 id="通过-webpack-将骨架屏打包到项目中"><a href="#通过-webpack-将骨架屏打包到项目中" class="headerlink" title="通过 webpack 将骨架屏打包到项目中"></a>通过 webpack 将骨架屏打包到项目中</h2><p>在上一个部分，我们分析了怎么去生成骨架屏，在这一部分，我们将探讨如何通过 webpack 将骨架屏打包的项目中。在这过程中，思考了以下一些问题：</p><p>为什么在开发过程中生成骨架屏？<br>其主要原因还是为了骨架屏的可编辑。</p><p>在上一个部分，我们通过一些样式和元素的修改生成了骨架屏页面，但是我们并没有马上将其写入到配置的输出文件夹中，在写入骨架页面到项目之前。我们通过 memory-fs 将骨架屏写入到内存中，以便我们能够通过预览页面进行访问。同时我们也将骨架屏源码发送到了预览页面，这样我们就可以通过修改源码，对骨架屏进行二次编辑。</p><p>正如这张图片，这张图是插件打开的骨架屏的预览页面，从左到右依次是开发中的真实页面、骨架屏、骨架屏可编辑源码。</p><p>这样我们就可以在开发过程中对骨架屏进行编辑，修改部分样式，中部骨架屏可以进行实时预览，这之间的通信都是通过websocket 来完成的。当我们对生成的骨架屏满意后，并点击右上角写入骨架屏按钮，将骨架屏写入到项目中，在最后项目构建时，将骨架屏打包到项目中。</p><p>如果我们同时在构建的过程中生成骨架屏，并打包到项目中，这时的骨架屏我们是无法预览的，因此我们对此时的骨架屏一无所知，也不能够做任何修改，这就是我们在开发中生成骨架屏的原因所在。</p><p>演讲最开始已经提到，目前流行的前端框架基本都是 JS 驱动，也就是说，在最初的 index.html 中我们不用写太多的 html 内容，而是等框架启动完成后，通过运行时将内容填充到 html 中，通常我们会在 html 模板中添加一个根元素：</p><div id="app"></div><p>当应用启动后，会将真实的内容填充到上面的元素中。这也就给了我们一个展示骨架屏的机会，我们将骨架屏在页面启动之前添加到上面元素内：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="comment">&lt;!-- shell.html --&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>怎样将骨架屏打包到项目中<br>Webpack 是一款优秀的前端打包工具，其也提供了一些丰富的 API 让我们可以自己编写一些插件来让 webpack 完成更多的工作，比如在构建过程中，将骨架屏打包到项目中。</p><p>Webpack 在整个打包的过程中提供了众多生命周期事件，比如compilation 、after-emit 等，比如我们最终将骨架屏插入到 html 中就是在after-emit 钩子函数中进行的，简单的代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">SkeletonPlugin</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">apply</span> = <span class="keyword">function</span> (<span class="params">compiler</span>) &#123;</span><br><span class="line">  <span class="comment">// 其他代码</span></span><br><span class="line">  compiler.<span class="title function_">plugin</span>(<span class="string">&#x27;after-emit&#x27;</span>, <span class="keyword">async</span> (compilation, done) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">outputSkeletonScreen</span>(<span class="variable language_">this</span>.<span class="property">originalHtml</span>, <span class="variable language_">this</span>.<span class="property">options</span>, <span class="variable language_">this</span>.<span class="property">server</span>.<span class="property">log</span>.<span class="property">info</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">server</span>.<span class="property">log</span>.<span class="title function_">warn</span>(err.<span class="title function_">toString</span>())</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">done</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 其他代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们再来看看 outputSkeletonScreen 是如何将骨架屏插入到原始的 HTML 中，并且写入到配置的输入文件夹的。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">outputSkeletonScreen</span> = <span class="keyword">async</span> (<span class="params">originHtml, options, log</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; pathname, staticDir, routes &#125; = options</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(routes.<span class="title function_">map</span>(<span class="keyword">async</span> (route) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> trimedRoute = route.<span class="title function_">replace</span>(<span class="regexp">/\//g</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> filePath = path.<span class="title function_">join</span>(pathname, trimedRoute ? <span class="string">`<span class="subst">$&#123;trimedRoute&#125;</span>.html`</span> : <span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> html = <span class="keyword">await</span> <span class="title function_">promisify</span>(fs.<span class="property">readFile</span>)(filePath, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> finalHtml = originHtml.<span class="title function_">replace</span>(<span class="string">&#x27;&lt;!-- shell --&gt;&#x27;</span>, html)</span><br><span class="line">    <span class="keyword">const</span> outputDir = path.<span class="title function_">join</span>(staticDir, route)</span><br><span class="line">    <span class="keyword">const</span> outputFile = path.<span class="title function_">join</span>(outputDir, <span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">await</span> fse.<span class="title function_">ensureDir</span>(outputDir)</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">promisify</span>(fs.<span class="property">writeFile</span>)(outputFile, finalHtml, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">`write <span class="subst">$&#123;outputFile&#125;</span> successfully in <span class="subst">$&#123;route&#125;</span>`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>()</span><br><span class="line">  &#125;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="更多思考"><a href="#更多思考" class="headerlink" title="更多思考"></a>更多思考</h2><p>Page Skeleton webpack 插件在我们内部团队已经开始使用，在使用的过程中我们也得到了一些反馈信息。</p><p>首先是对 SPA 多路由的支持，其实现在插件已经支持多路由了，只是还没有用到真实项目中，我们针对每一个路由页面生成一个单独的 index.html，也就是静态路由。然后将每个路由生成的骨架屏插入到不同的静态路由的 html 中。</p><p>其次，玩过服务端渲染的同学都知道，在 React 和 Vue 服务端渲染中有一种称为 Client-side Hydration 的技术，指的是在 Vue 在浏览器接管由服务端发送来的静态 HTML，使其变为由 Vue 管理的动态 DOM 的过程。</p><p>在我们构建骨架屏的过程中，其 DOM 结构和真实页面的 DOM 结构基本相同，只是添加了一些行内样式和 classname，我们也在思考这些 DOM 能够被复用，也就是在应用启动时重新创建所有 DOM。我们只用激活这些骨架屏 DOM，让其能够相应数据的变化，这似乎就可以使骨架屏和真实页面更好的融合。</p><p>还有，在页面启动后，我们可能还是会通过 AJAX 获取后端数据，这时候我们也可以通过 骨架屏 来作为一种加载状态。也就是说，其实我们可以在「非首屏骨架屏」上做一些工作。</p><p>最后，在项目中可能会有一些性能监控的需求，比如骨架屏什么时候创建，什么时候被销毁，这些我们可能都希望通过一些性能监控的工具记录下来，以便将来做一些性能上面的分析。因此将来也会提供一些骨架屏的生命周期函数，或者提供相应的自定义事件，在生命周期不同阶段，调用相应的生命周期钩子函数或监听相应事件，这样就可以将骨架屏的一些数据记录到性能监控软件中。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 骨架屏 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Js数字大小受限问题</title>
      <link href="/2022/12/17/Js%E6%95%B0%E5%AD%97%E5%A4%A7%E5%B0%8F%E5%8F%97%E9%99%90%E9%97%AE%E9%A2%98/"/>
      <url>/2022/12/17/Js%E6%95%B0%E5%AD%97%E5%A4%A7%E5%B0%8F%E5%8F%97%E9%99%90%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="js里的数字大小受限问题"><a href="#js里的数字大小受限问题" class="headerlink" title="js里的数字大小受限问题"></a>js里的数字大小受限问题</h1><blockquote><p>用json-bigint第三方包,可以解决js处理数据只能识别 2^52的整数</p></blockquote><ol><li><p>安装</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add json-bigint</span><br></pre></td></tr></table></figure></li><li><p>在axios请求模块中引入</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">JSON</span>Big <span class="keyword">from</span> <span class="string">&#x27;json-bigint&#x27;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="JSONBig方法"><a href="#JSONBig方法" class="headerlink" title="JSONBig方法"></a>JSONBig方法</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这个方法会把超出安全范围的数字封装在bignumber的对象里，想要用的话，就把这个对象.tostring(),转为字符串就可以正确显示了。  </span></span><br><span class="line"><span class="title class_">JSON</span>Big.<span class="title function_">parse</span>() <span class="comment">//JSON字符串转成js对象  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//用 JSONBig.parse() 转的js对象，一定要用JSON.Big.Stringify() 转回JSON字符串</span></span><br><span class="line"><span class="title class_">JSON</span>Big.<span class="title class_">Stringify</span>()<span class="comment">//js对象转成JSON字符串</span></span><br></pre></td></tr></table></figure><ol><li>在axios请求模块中添加配置： 改变接收原始数据的方法<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line"></span><br><span class="line"><span class="attr">baseURL</span>: <span class="string">&#x27;http://toutiao.itheima.net/&#x27;</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">//在请求模块拦截接收的数据，手动用JSONBig转换接收的JSON字符串（默认会给我们用json.parse()的方法）</span></span><br><span class="line"><span class="attr">transformResponse</span>: [<span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do whatever you want to transform the data</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title class_">JSON</span>Big.<span class="title function_">parse</span>(data)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;]</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ol><ul><li>小问题： 非安全数字转为js对象时，会被封装成bignumber对象，所以有时要用tostring转换</li><li>但是，比如拼接字符串时，会自动把对象转换为字符串，所以不用转换，比如url拼接.</li></ul>]]></content>
      
      
      <categories>
          
          <category> Js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>scoped模式</title>
      <link href="/2022/12/17/scoped%E6%A8%A1%E5%BC%8F/"/>
      <url>/2022/12/17/scoped%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="scoped模式"><a href="#scoped模式" class="headerlink" title="scoped模式"></a>scoped模式</h1><blockquote><p>想要解决这个问题，就要添加deep属性,因为这个模式不能改变引入样式的子级样式，需要加deep,但是根样式还是可以改变的</p></blockquote><h2 id="第一种：加上父级自己定义的类名-common-container-gt-gt-gt-（只作用于css）"><a href="#第一种：加上父级自己定义的类名-common-container-gt-gt-gt-（只作用于css）" class="headerlink" title="第一种：加上父级自己定义的类名.common-container &gt;&gt;&gt; （只作用于css）"></a>第一种：加上父级自己定义的类名<code>.common-container &gt;&gt;&gt;</code> （只作用于css）</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.common-container &gt;&gt;&gt; .van-pull-refresh__head &#123;</span><br><span class="line">  color: #fff;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="第二种：有些Sass-、Less之类的预处理器无法正确解析-gt-gt-gt-。可以使用-deep-操作符或-v-deep-操作符-两者都是-gt-gt-gt-的别名"><a href="#第二种：有些Sass-、Less之类的预处理器无法正确解析-gt-gt-gt-。可以使用-deep-操作符或-v-deep-操作符-两者都是-gt-gt-gt-的别名" class="headerlink" title="第二种：有些Sass 、Less之类的预处理器无法正确解析 &gt;&gt;&gt;。可以使用 /deep/操作符或 ::v-deep 操作符( 两者都是&gt;&gt;&gt; 的别名)"></a>第二种：有些Sass 、Less之类的预处理器无法正确解析 <code>&gt;&gt;&gt;</code>。可以使用 <code>/deep/</code>操作符或 <code>::v-deep</code> 操作符( 两者都是<code>&gt;&gt;&gt;</code> 的别名)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">/deep/ .van-list__error-text, </span><br><span class="line">/deep/ .van-list__finished-text,  </span><br><span class="line">/deep/ .van-list__loading ,</span><br><span class="line">/deep/ .van-pull-refresh__head ,</span><br><span class="line">/deep/ .van-loading__text &#123;</span><br><span class="line">  color: #fff;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.common-container&#123;</span><br><span class="line">    &amp;::v-deep .van-pull-refresh__head&#123;</span><br><span class="line">     color: #fff;</span><br><span class="line">        // ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue的动画组件</title>
      <link href="/2022/12/17/vue%E7%9A%84%E5%8A%A8%E7%94%BB%E7%BB%84%E4%BB%B6/"/>
      <url>/2022/12/17/vue%E7%9A%84%E5%8A%A8%E7%94%BB%E7%BB%84%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="vue的动画组件"><a href="#vue的动画组件" class="headerlink" title="vue的动画组件"></a>vue的动画组件</h1><p>vue中内置了一个全局组件</p><ul><li>当vue中，显示隐藏，创建移除，一个元素或者一个组件的时候，可以通过transition实现动画。</li></ul><p>![[Pasted image 20221013110735.png]]</p><p>如果元素或组件离开，完成一个淡出效果：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transition</span> <span class="attr">name</span>=<span class="string">&quot;fade&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">&quot;show&quot;</span>&gt;</span>100<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.fade-leave</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fade-leave-active</span> &#123;</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">1s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fade-leave-to</span> &#123;</span><br><span class="line">    opcaity: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>进入（显示，创建）<ul><li>v-enter 进入前 （vue3.0 v-enter-from）</li><li>v-enter-active 进入中</li><li>v-enter-to 进入后</li></ul></li><li>离开（隐藏，移除）<ul><li>v-leave 进入前 （vue3.0 v-leave-from）</li><li>v-leave-active 进入中</li><li>v-leave-to 进入后</li></ul></li></ul><p>多个transition使用不同动画，可以添加nam属性，name属性的值替换v即可。</p>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git基础操作</title>
      <link href="/2022/12/16/Git%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/"/>
      <url>/2022/12/16/Git%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<h1 id="Git基础操作"><a href="#Git基础操作" class="headerlink" title="Git基础操作"></a>Git基础操作</h1><ol><li>git的流程就是 先本地操作，然后在提交给暂存区，然后给仓库，然后给远程</li><li>本地文件的每一步改变，都要再次提交给仓库，仓库也有再次提交给远程</li><li>仓库的每一次改变，包括删除文件，都要提交给仓库一次</li><li>目的都是保证 仓库，远程，本地是逻辑上统一的，除非你本地不想让仓库看，但是，仓库一定是和远程统一的</li><li>也就是说，一切都是本地操作，一损俱损，想给仓库或者远程赠增删改查，就要先改变本地，然后一步步提交上去<h2 id="获取帮助信息"><a href="#获取帮助信息" class="headerlink" title="获取帮助信息"></a>获取帮助信息</h2></li></ol><p>git help &lt; verb &gt;<br>git config -h</p><h2 id="创建git仓库"><a href="#创建git仓库" class="headerlink" title="创建git仓库"></a>创建git仓库</h2><blockquote><p>会创建一个名为 .git 的隐藏目录，这个 .git 目录就是当前项目的 Git 仓库，里面包含了初始的必要<br>文件，这些文件是 Git 仓库的必要组成部分。</p></blockquote><p>git init </p><h2 id="查询文件状态"><a href="#查询文件状态" class="headerlink" title="查询文件状态"></a>查询文件状态</h2><p>git status<br>git status -s</p><h2 id="提交到暂存区"><a href="#提交到暂存区" class="headerlink" title="提交到暂存区"></a>提交到暂存区</h2><p>git add &lt; verb &gt;    可以用它开始跟踪新文件  把已跟踪的、且已修改的文件放到暂存区<br>git add .        一次性将所有的新增和修改过的文件加入暂存区</p><h2 id="取消暂存区文件"><a href="#取消暂存区文件" class="headerlink" title="取消暂存区文件"></a>取消暂存区文件</h2><p>git reset &lt; verb &gt;</p><h2 id="提交到仓库"><a href="#提交到仓库" class="headerlink" title="提交到仓库"></a>提交到仓库</h2><p>git commit -m ” 描述消息“        提交暂存区文件到仓库<br>git commit -a -m ”描述消息“    可以把工作区文件提交到暂存区</p><h2 id="恢复工作区文件"><a href="#恢复工作区文件" class="headerlink" title="恢复工作区文件"></a>恢复工作区文件</h2><blockquote><p>把对工作区中对应文件的修改，还原成 Git 仓库中所保存的版本</p></blockquote><p>git checkout — &lt; verb &gt; 命令</p><h2 id="移除仓库文件"><a href="#移除仓库文件" class="headerlink" title="移除仓库文件"></a>移除仓库文件</h2><ol><li>git rm -f &lt; verb &gt;    从仓库和工作区同时移除</li><li>git rm —cached  &lt; verb &gt;   只删除git仓库文件，保留工作区文件</li><li>git rm —cached -r 文件名   删除文件夹，包括递归文件夹  保留工作区文件</li></ol><h2 id="忽略文件"><a href="#忽略文件" class="headerlink" title="忽略文件"></a>忽略文件</h2><p>创建一个.gitignore的配置文件，在配置文件里，添加要忽略的文件，可以用glob模式简化正则表达式</p><h2 id="查看提交仓库历史"><a href="#查看提交仓库历史" class="headerlink" title="查看提交仓库历史"></a>查看提交仓库历史</h2><p>git log  显示最近记录<br>git log -2  显示最进提交2个记录</p><h2 id="reset回退-和-revert撤销"><a href="#reset回退-和-revert撤销" class="headerlink" title="reset回退 和 revert撤销"></a>reset回退 和 revert撤销</h2><p>在利用git实现多人合作程序开发的过程中，我们有时会出现 <strong>错误提交</strong> 的情况，</p><p>此时我们希望能撤销提交操作, 或者想要回退到某个版本</p><ol><li>git log  —pretty=online   在一行上显示所有提交历史，查找提交ID</li><li>reset =&gt; 回退到某个版本 <code>git reset --hard 版本号</code></li><li>evert =&gt; 撤销某个版本内容的内容修改 <code>git revert -n 版本号</code></li></ol><p>博客参考: <a href="https://blog.csdn.net/yxlshk/article/details/79944535" title="https://blog.csdn.net/yxlshk/article/details/79944535">https://blog.csdn.net/yxlshk/article/details/79944535</a></p><p>如果git reset 后, 版本回退了, 无法直接push 到远程仓库(因为远程仓库版本更加新) =&gt; git push -f 覆盖推送即可<br>效果: 将远程仓库的版本, 也进行了回退</p><h1 id="Git本地分支"><a href="#Git本地分支" class="headerlink" title="Git本地分支"></a>Git本地分支</h1><h2 id="主分支"><a href="#主分支" class="headerlink" title="主分支"></a>主分支</h2><blockquote><p>master主分支，git默认帮忙创建的。一般不会直接操作主分支，用来保存和记录整个项目已完成的功能代码。</p><h2 id="功能分支"><a href="#功能分支" class="headerlink" title="功能分支"></a>功能分支</h2><p>专门用来开发新功能的分支,从主分支上临时分出来，当任务介绍后再合并在主分支上</p></blockquote><h2 id="查看分支列表"><a href="#查看分支列表" class="headerlink" title="查看分支列表"></a>查看分支列表</h2><p>git branch  查询仓库所有分支列表<br>带 * 号为当前分支</p><h2 id="创建分支"><a href="#创建分支" class="headerlink" title="创建分支"></a>创建分支</h2><blockquote><p>创建的分支不会自动切换到新分支，要手动切换</p></blockquote><p>git branch 分支名称   基于当前分支创建新分支，新分支代码和当前分支一样</p><h2 id="切换分支"><a href="#切换分支" class="headerlink" title="切换分支"></a>切换分支</h2><p>git checkout 分支名称   </p><h3 id="快速创建切换分支"><a href="#快速创建切换分支" class="headerlink" title="快速创建切换分支"></a>快速创建切换分支</h3><p>git checkout -b  分支名称    创建新分支，同时自动切换为新分支</p><h2 id="删除分支"><a href="#删除分支" class="headerlink" title="删除分支"></a>删除分支</h2><ul><li>当代码合并之后，老的分支就没有用了，要删除<br>git branch -d 分支名称</li></ul><h1 id="Git远程分支"><a href="#Git远程分支" class="headerlink" title="Git远程分支"></a>Git远程分支</h1><h2 id="本地分支推送远程仓库"><a href="#本地分支推送远程仓库" class="headerlink" title="本地分支推送远程仓库"></a>本地分支推送远程仓库</h2><ul><li>第一次推送加 -u  以后可以不加<br>git push -u 远程仓库别名 本地分支名称:远程分支名称    (推送本地分支，并创建不同名称的远程分支)<br>git push -u 远程仓库别名 本地分支名称    （推送本地分支，并创建名称一致的远程分支）</li></ul><h2 id="远程分支推送本地仓库"><a href="#远程分支推送本地仓库" class="headerlink" title="远程分支推送本地仓库"></a>远程分支推送本地仓库</h2><p>git checkout 远程分支名称<br>git checkout -b 本地分支名称 远程仓库名称/远程分支名称</p><h2 id="查看远程分支列表"><a href="#查看远程分支列表" class="headerlink" title="查看远程分支列表"></a>查看远程分支列表</h2><p>git remote show 远程仓库名称<br>git remote -v</p><h2 id="拉取远程分支最新代码"><a href="#拉取远程分支最新代码" class="headerlink" title="拉取远程分支最新代码"></a>拉取远程分支最新代码</h2><p>git pull （拉取最新代码，保持当前分支与远程分支一致）</p><h2 id="删除远程分支"><a href="#删除远程分支" class="headerlink" title="删除远程分支"></a>删除远程分支</h2><p>git push 远程仓库名称 —delete 远程分支名称</p><h2 id="修改远程仓库地址"><a href="#修改远程仓库地址" class="headerlink" title="修改远程仓库地址"></a>修改远程仓库地址</h2><ol><li>直接修改远程仓库地址</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote set-url origin 复制上仓库地址</span><br></pre></td></tr></table></figure><ol><li>先删除再修改地址</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote rm origin</span><br><span class="line">git remote add origin 复制上仓库地址</span><br></pre></td></tr></table></figure><p>&gt;</p><h2 id="合并分支"><a href="#合并分支" class="headerlink" title="合并分支"></a>合并分支</h2><ul><li>合并分支一定要在主分支上进行</li></ul><ol><li>切换到主分支 git checkout master</li><li>git merge 要合并分支名称    </li></ol><h3 id="合并分支冲突"><a href="#合并分支冲突" class="headerlink" title="合并分支冲突"></a>合并分支冲突</h3><ol><li>git checkout master</li><li>git merge 分支名称</li><li>打开冲突的文件，手动确认，此时文件变为已修改文件</li><li>git add .   添加文件到暂存区</li><li>git commit -m “描述消息”</li></ol><h1 id="GIthub"><a href="#GIthub" class="headerlink" title="GIthub"></a>GIthub</h1><ol><li>创建本地仓库，git init</li><li>创建ssh秘钥，ssh-keygen -t rsa -b 4096 -C “github创建邮箱”     </li><li>生成ssh秘钥,  存放在用户-用户名-.ssh里  —然后配置github</li><li>检测是否成功  ssh -T git@github.com</li><li>保证仓库里面有提交的信息，也就是保证仓库与工作区同步过</li><li>git remote add 远程仓库名 git@github.com:S-Huan/shaohuan_De_notes.git</li><li>git push -u 远程仓库名 远程分支名</li></ol>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>全屏插件的引用</title>
      <link href="/2022/12/16/%E5%85%A8%E5%B1%8F%E6%8F%92%E4%BB%B6%E7%9A%84%E5%BC%95%E7%94%A8/"/>
      <url>/2022/12/16/%E5%85%A8%E5%B1%8F%E6%8F%92%E4%BB%B6%E7%9A%84%E5%BC%95%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="全屏插件的引用"><a href="#全屏插件的引用" class="headerlink" title="全屏插件的引用"></a>全屏插件的引用</h1><p><strong>目标</strong>：实现页面的全屏功能</p><p>原生方法：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">requestFullscreen</span>()  <span class="comment">//开启全屏</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">exitFullscreen</span>()  <span class="comment">//退出全屏</span></span><br></pre></td></tr></table></figure></p><blockquote><p>全屏功能可以借助一个插件来实现</p></blockquote><p>第一步，安装全局插件<strong>screenfull</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ npm i screenfull</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>第二步，封装全屏显示的插件·· <strong><code>src/components/ScreenFull/index.vue</code></strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 放置一个图标 --&gt;</span><br><span class="line"></span><br><span class="line">&lt;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 放置一个svg的图标 --&gt;</span><br><span class="line"></span><br><span class="line">&lt;svg-icon icon-class=&quot;fullscreen&quot; style=&quot;color:#fff; width: 20px; height: 20px&quot; @click=&quot;changeScreen&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">import ScreenFull from &#x27;screenfull&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line"></span><br><span class="line">methods: &#123;</span><br><span class="line"></span><br><span class="line">// 改变全屏</span><br><span class="line"></span><br><span class="line">changeScreen() &#123;</span><br><span class="line"></span><br><span class="line">if (!ScreenFull.isEnabled) &#123;</span><br><span class="line"></span><br><span class="line">// 此时全屏不可用</span><br><span class="line"></span><br><span class="line">this.$message.warning(&#x27;此时全屏组件不可用&#x27;)</span><br><span class="line"></span><br><span class="line">return</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// document.documentElement.requestFullscreen() 原生js调用</span><br><span class="line"></span><br><span class="line">// 如果可用 就可以全屏</span><br><span class="line"></span><br><span class="line">ScreenFull.toggle()  //既可以全屏又可以退出全屏</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>第三步，全局注册该组件 <strong><code>src/components/index.js</code></strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ScreenFull</span> <span class="keyword">from</span> <span class="string">&#x27;./ScreenFull&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;ScreenFull&#x27;</span>, <span class="title class_">ScreenFull</span>) <span class="comment">// 注册全屏组件</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>第四步，放置于<strong><code>layout/navbar.vue</code></strong>中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;screen-full class=&quot;right-menu-item&quot; /&gt;</span><br><span class="line"></span><br><span class="line">.right-menu-item &#123;</span><br><span class="line"></span><br><span class="line">vertical-align: middle;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 插件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vueuse/core 工具库</title>
      <link href="/2022/12/16/vueuse%20%E5%B7%A5%E5%85%B7%E5%BA%93/"/>
      <url>/2022/12/16/vueuse%20%E5%B7%A5%E5%85%B7%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<h1 id="vueuse-core-工具库"><a href="#vueuse-core-工具库" class="headerlink" title="@vueuse/core 工具库"></a>@vueuse/core 工具库</h1><p>安装：@vueuse/core 包，它封装了常见的一些交互逻辑。</p><ul><li>vue3.0组合API提供了更多逻辑代码封装的能力。@vueuse/core 基于组合API封装好用的工具函数。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @vueuse/core@4.9.0</span><br></pre></td></tr></table></figure><ol><li>useWindowScroll() 是@vueuse/core提供的api可返回当前页面滚动时候蜷曲的距离。x横向，y纵向</li><li>useVModel 实现快捷子父组件的数据双向绑定<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useVModel &#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span><br><span class="line"><span class="comment">// v-model  ====&gt;  :modelValue  +   @update:modelValue</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;XtxCheckbox&#x27;</span>,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">modelValue</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  setup (props, &#123; emit &#125;) &#123;</span><br><span class="line">    <span class="comment">// 使用useVModel实现双向数据绑定v-model指令</span></span><br><span class="line">    <span class="comment">// 1. 使用props接收modelValue</span></span><br><span class="line">    <span class="comment">// 2. 使用useVModel来包装props中的modelValue属性数据</span></span><br><span class="line">    <span class="comment">// 3. 在使用checked.value就是使用父组件数据</span></span><br><span class="line">    <span class="comment">// 4. 在使用checked.value = &#x27;数据&#x27; 赋值，触发emit(&#x27;update:modelvalue&#x27;, &#x27;数据&#x27;)</span></span><br><span class="line">    <span class="keyword">const</span> checked = <span class="title function_">useVModel</span>(props, <span class="string">&#x27;modelValue&#x27;</span>, emit)</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">changeChecked</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> newVal = !checked.<span class="property">value</span></span><br><span class="line">      <span class="comment">// 通知父组件</span></span><br><span class="line">      checked.<span class="property">value</span> = newVal</span><br><span class="line">      <span class="comment">// 让组件支持change事件</span></span><br><span class="line">      <span class="title function_">emit</span>(<span class="string">&#x27;change&#x27;</span>, newVal)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123; checked, changeChecked &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>监听属性外点击事件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; onClickOutside &#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">onClickOutside</span>(target, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="title function_">closeDialog</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>定时器工具逻辑</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定时器逻辑</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// useIntervalFn 1. 回调函数， 时间间隔， 是否立即开启</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> time = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; pause, resume &#125; = <span class="title function_">useIntervalFn</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (time.<span class="property">value</span> &lt;= <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="title function_">pause</span>()</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">time.<span class="property">value</span>--</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;, <span class="number">1000</span>, <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 销毁定时器</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="title function_">pause</span>()</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>懒加载方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// stop 是停止观察是否进入或移出可视区域的行为    </span></span><br><span class="line"><span class="keyword">const</span> &#123; stop &#125; = <span class="title function_">useIntersectionObserver</span>(</span><br><span class="line">  <span class="comment">// target 是观察的目标dom容器，必须是dom容器，而且是vue3.0方式绑定的dom对象</span></span><br><span class="line">  target,</span><br><span class="line">  <span class="comment">// isIntersecting 是否进入可视区域，true是进入 false是移出</span></span><br><span class="line">  <span class="comment">// observerElement 被观察的dom</span></span><br><span class="line">  <span class="function">(<span class="params">[&#123; isIntersecting &#125;], observerElement</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 在此处可根据isIntersecting来判断，然后做业务</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">  <span class="attr">threshold</span>: <span class="number">0.</span> <span class="comment">//阈值，监控到哪里才会算数</span></span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Js </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>关于</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      
        <content type="html"><![CDATA[<p>这是一个前端初学者的博客， 一切代码解释权归本人所有， 如发现错误， 请偷偷的告诉我。</p>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>归档</title>
      <link href="/archives/index.html"/>
      <url>/archives/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>分类</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/Gallery/ohmygirl.html"/>
      <url>/Gallery/ohmygirl.html</url>
      
        <content type="html"><![CDATA[<div class="fj-gallery"><p><img src="https://i.loli.net/2019/12/25/Fze9jchtnyJXMHN.jpg" alt=""><br><img src="https://i.loli.net/2019/12/25/ryLVePaqkYm4TEK.jpg" alt=""><br><img src="https://i.loli.net/2019/12/25/gEy5Zc1Ai6VuO4N.jpg" alt=""><br><img src="https://i.loli.net/2019/12/25/d6QHbytlSYO4FBG.jpg" alt=""><br><img src="https://i.loli.net/2019/12/25/6nepIJ1xTgufatZ.jpg" alt=""><br><img src="https://i.loli.net/2019/12/25/E7Jvr4eIPwUNmzq.jpg" alt=""><br><img src="https://i.loli.net/2019/12/25/mh19anwBSWIkGlH.jpg" alt=""><br><img src="https://i.loli.net/2019/12/25/2tu9JC8ewpBFagv.jpg" alt=""></p>          </div>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/css/custom.css"/>
      <url>/css/custom.css</url>
      
        <content type="html"><![CDATA[/* 页脚与头图透明 */#footer {    background: rgba(55, 55, 55, 0.6) !important;}#page-header {    background: transparent !important;}/* 白天模式遮罩透明 */#footer::before {    background: rgba(55, 55, 55, 0.6) !important;}#page-header::before {    background: transparent !important;}/* 夜间模式遮罩透明 */[data-theme="dark"] #footer::before {    background: rgba(55, 55, 55, 0.6) !important;}[data-theme="dark"] #page-header::before {    background: transparent !important;}/* 翻页按钮居中 */#pagination {    width: 100%;    margin: auto;}/* 侧边栏个人信息卡片动态渐变色 */#aside-content>.card-widget.card-info {    background: linear-gradient(-45deg,            #e8d8b9,            #eccec5,            #a3e9eb,            #bdbdf0,            #eec1ea);    box-shadow: 0 0 5px rgb(66, 68, 68);    position: relative;    background-size: 400% 400%;    -webkit-animation: Gradient 10s ease infinite;    -moz-animation: Gradient 10s ease infinite;    animation: Gradient 10s ease infinite !important;}@-webkit-keyframes Gradient {    0% {        background-position: 0% 50%;    }    50% {        background-position: 100% 50%;    }    100% {        background-position: 0% 50%;    }}@-moz-keyframes Gradient {    0% {        background-position: 0% 50%;    }    50% {        background-position: 100% 50%;    }    100% {        background-position: 0% 50%;    }}@keyframes Gradient {    0% {        background-position: 0% 50%;    }    50% {        background-position: 100% 50%;    }    100% {        background-position: 0% 50%;    }}/* 黑夜模式适配 */[data-theme="dark"] #aside-content>.card-widget.card-info {    background: #191919ee;}/* 个人信息Follow me按钮#aside-content>.card-widget.card-info>#card-info-btn {    background-color: #3eb8be;    border-radius: 8px;} */:root {    --trans-light: rgba(255, 255, 255, 0.88);    --trans-dark: rgba(25, 25, 25, 0.88);    --border-style: 1px solid rgb(169, 169, 169);    --backdrop-filter: blur(5px) saturate(150%);    background-clip: content-box;}/* 首页文章卡片 */#recent-posts>.recent-post-item {    background: var(--trans-light);    backdrop-filter: var(--backdrop-filter);    border-radius: 25px;    border: var(--border-style);}/* 首页侧栏卡片 */#aside-content .card-widget {    background: var(--trans-light);    backdrop-filter: var(--backdrop-filter);    border-radius: 18px;    border: var(--border-style);}/* 文章页、归档页、普通页面 */div#post,div#page,div#archive {    background: var(--trans-light);    backdrop-filter: var(--backdrop-filter);    border: var(--border-style);    border-radius: 20px;}/* 导航栏 */#page-header.nav-fixed #nav {    background: rgba(255, 255, 255, 0.75);    backdrop-filter: var(--backdrop-filter);}[data-theme="dark"] #page-header.nav-fixed #nav {    background: rgba(0, 0, 0, 0.7) !important;}/* 夜间模式遮罩 */[data-theme="dark"] #recent-posts>.recent-post-item,[data-theme="dark"] #aside-content .card-widget,[data-theme="dark"] div#post,[data-theme="dark"] div#archive,[data-theme="dark"] div#page {    background: var(--trans-dark);}/* 夜间模式页脚页头遮罩透明 */[data-theme="dark"] #footer::before {    background: transparent !important;}[data-theme="dark"] #page-header::before {    background: transparent !important;}/* 阅读模式 */.read-mode #aside-content .card-widget {    background: rgba(158, 204, 171, 0.5) !important;}.read-mode div#post {    background: rgba(158, 204, 171, 0.5) !important;}/* 夜间模式下的阅读模式 */[data-theme="dark"] .read-mode #aside-content .card-widget {    background: rgba(25, 25, 25, 0.9) !important;    color: #ffffff;}[data-theme="dark"] .read-mode div#post {    background: rgba(25, 25, 25, 0.9) !important;    color: #ffffff;}/* 自定义底部  start */#ft {    max-width: 1200px;    margin: 0 auto 12px;    display: flex;    color: rgb(255 255 255 / 80%) !important;    text-align: left;    flex-wrap: wrap;}.ft-item-1,.ft-item-2 {    display: flex;    height: 100%;    padding: 10px 14px;}.ft-item-1 {    flex-direction: column;    flex: 2;}.ft-item-2 {    flex: 1;    flex-direction: column;}.t-top {    display: flex;}.t-top .t-t-l {    display: flex;    flex-direction: column;    flex: 1.4;    margin-right: 10px;}.t-top .t-t-l .bg-ad {    width: 85%;    border-radius: 10px;    padding: 0 10px;}.btn-xz-box {    margin-top: 10px;}.btn-xz {    display: block;    background-color: var(--btn-bg);    color: var(--btn-color);    text-align: center;    line-height: 2.4;    margin: 8px 0;    cursor: pointer !important;}.btn-xz:hover {    text-decoration: none !important;}.btn-xz-box:hover .btn-xz {    background-color: #6f42c1;}.t-top .t-t-r {    display: flex;    flex-direction: column;    flex: 1;}.ft-links {    padding: 0 14px;    list-style: none;    margin-top: 0 !important;}.ft-links li a {    display: inline-block !important;    width: 50%;    cursor: pointer !important;}.ft-links li a:hover {    text-decoration: none !important;    color: #6f42c1 !important;}.ft-item-2 .ft-img-group {    width: 100%;}.ft-t {    font-size: 0.8rem;    margin-bottom: 20px;    line-height: 1;    font-weight: 600;}.t-l-t {    padding-left: 14px;}.ft-item-2 .ft-img-group .img-group-item {    display: inline-block;    width: 18.4%;    margin-right: 14px;    margin-bottom: 6px;}.ft-item-2 .ft-img-group .img-group-item a {    display: inline-block;    width: 100%;    height: 100%;    cursor: pointer !important;}.ft-item-2 .ft-img-group .img-group-item a img {    width: 100%;    max-height: 80px;}@media screen and (max-width: 768px) {    .ft-item-1 {        flex-basis: 100% !important;    }    .ft-item-2 {        flex-basis: 100% !important;    }    .t-top .t-t-l .bg-ad {        width: 100%;    }}@media screen and (max-width: 576px) {    .t-top {        flex-wrap: wrap;    }    .t-top .t-t-l {        flex-basis: 100% !important;    }    .t-top .t-t-r {        margin-top: 16px;        flex-basis: 100% !important;    }}#web_bg {    background-position: top;background-attachment: scroll;background-clip: content-box;}/* 自定义底部  End *//* Twikoo 评论样式 */.tk-input .el-textarea__inner {    min-height: 120px !important;}#twikoo .OwO-body {    max-width: 100% !important;}#twikoo .OwO .OwO-body .OwO-items:nth-child(1),#twikoo .OwO .OwO-body .OwO-items:nth-child(4) {    max-height: 360px !important;}#twikoo .OwO-items li[title|=menhera] img {    width: 100% !important;    margin: 5px 10px;}.tk-comment .tk-owo-emotion[alt*=menhera] {    width: 300px !important;}.tk-comment .vemoji[alt|=menhera],.tk-comment .tk-owo-emotion[alt*=menhera] {    max-width: 300px !important;    max-height: 300px !important;    margin: 8px 1px;    display: block !important;}@media screen and (max-width: 768px) {    .tk-comment .vemoji[alt|=menhera],    .tk-comment .tk-owo-emotion[alt*=menhera] {        max-width: calc(100% - 30px) !important;        max-height: calc(100% - 30px) !important;    }    .OwO .OwO-body .OwO-items-image .OwO-item[title*=menhera] {        max-width: calc(50% - 10px);        box-sizing: border-box;    }}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/css/universe.css"/>
      <url>/css/universe.css</url>
      
        <content type="html"><![CDATA[/* 背景宇宙星光  */#universe {    display: block;    position: fixed;    margin: 0;    padding: 0;    border: 0;    outline: 0;    left: 0;    top: 0;    width: 100%;    height: 100%;    pointer-events: none;    /* 这个是调置顶的优先级的，-1在文章页下面，背景上面，个人推荐这种 */    z-index: -1;}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>Gallery</title>
      <link href="/Gallery/index.html"/>
      <url>/Gallery/index.html</url>
      
        <content type="html"><![CDATA[<div class="gallery-group-main">  <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src='https://bu.dusays.com/2021/03/06/38a2c5cd8b44e.jpg' alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">壁纸</div>  <p>收藏的一些壁纸</p>  <a href='/Gallery/wallpaper'></a>  </figcaption>  </figure>    <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src='https://i.loli.net/2019/12/25/8t97aVlp4hgyBGu.jpg' alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">漫威</div>  <p>关于漫威的图片</p>  <a href='/Gallery/marvel'></a>  </figcaption>  </figure>    <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src='https://i.loli.net/2019/12/25/hOqbQ3BIwa6KWpo.jpg' alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">OH MY GIRL</div>  <p>关于OH MY GIRL的图片</p>  <a href='/Gallery/ohmygirl'></a>  </figcaption>  </figure>  </div>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/universe.js"/>
      <url>/js/universe.js</url>
      
        <content type="html"><![CDATA[function dark() {window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;var n,e,i,h,t=.05,s=document.getElementById("universe"),o=!0,a="180,184,240",r="226,225,142",d="226,225,224",c=[];function f(){n=window.innerWidth,e=window.innerHeight,i=.216*n,s.setAttribute("width",n),s.setAttribute("height",e)}function u(){h.clearRect(0,0,n,e);for(var t=c.length,i=0;i<t;i++){var s=c[i];s.move(),s.fadeIn(),s.fadeOut(),s.draw()}}function y(){this.reset=function(){this.giant=m(3),this.comet=!this.giant&&!o&&m(10),this.x=l(0,n-10),this.y=l(0,e),this.r=l(1.1,2.6),this.dx=l(t,6*t)+(this.comet+1-1)*t*l(50,120)+2*t,this.dy=-l(t,6*t)-(this.comet+1-1)*t*l(50,120),this.fadingOut=null,this.fadingIn=!0,this.opacity=0,this.opacityTresh=l(.2,1-.4*(this.comet+1-1)),this.do=l(5e-4,.002)+.001*(this.comet+1-1)},this.fadeIn=function(){this.fadingIn&&(this.fadingIn=!(this.opacity>this.opacityTresh),this.opacity+=this.do)},this.fadeOut=function(){this.fadingOut&&(this.fadingOut=!(this.opacity<0),this.opacity-=this.do/2,(this.x>n||this.y<0)&&(this.fadingOut=!1,this.reset()))},this.draw=function(){if(h.beginPath(),this.giant)h.fillStyle="rgba("+a+","+this.opacity+")",h.arc(this.x,this.y,2,0,2*Math.PI,!1);else if(this.comet){h.fillStyle="rgba("+d+","+this.opacity+")",h.arc(this.x,this.y,1.5,0,2*Math.PI,!1);for(var t=0;t<30;t++)h.fillStyle="rgba("+d+","+(this.opacity-this.opacity/20*t)+")",h.rect(this.x-this.dx/4*t,this.y-this.dy/4*t-2,2,2),h.fill()}else h.fillStyle="rgba("+r+","+this.opacity+")",h.rect(this.x,this.y,this.r,this.r);h.closePath(),h.fill()},this.move=function(){this.x+=this.dx,this.y+=this.dy,!1===this.fadingOut&&this.reset(),(this.x>n-n/4||this.y<0)&&(this.fadingOut=!0)},setTimeout(function(){o=!1},50)}function m(t){return Math.floor(1e3*Math.random())+1<10*t}function l(t,i){return Math.random()*(i-t)+t}f(),window.addEventListener("resize",f,!1),function(){h=s.getContext("2d");for(var t=0;t<i;t++)c[t]=new y,c[t].reset();u()}(),function t(){document.getElementsByTagName('html')[0].getAttribute('data-theme')=='dark'&&u(),window.requestAnimationFrame(t)}()};dark()]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>音乐</title>
      <link href="/music/index.html"/>
      <url>/music/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>便签</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>友链</title>
      <link href="/link/index.html"/>
      <url>/link/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>电影</title>
      <link href="/movies/index.html"/>
      <url>/movies/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/css/iconfont.css"/>
      <url>/css/iconfont.css</url>
      
        <content type="html"><![CDATA[@font-face {  font-family: "iconfont"; /* Project id 3830154 */  /* Color fonts */  src:        url('iconfont.woff2?t=1671263507731') format('woff2'),       url('iconfont.woff?t=1671263507731') format('woff'),       url('iconfont.ttf?t=1671263507731') format('truetype');}.iconfont {  font-family: "iconfont" !important;  font-size: 16px;  font-style: normal;  -webkit-font-smoothing: antialiased;  -moz-osx-font-smoothing: grayscale;}.icon-youxiang:before {  content: "\e908";}.icon-wechat-fill:before {  content: "\e883";}.icon-github-fill:before {  content: "\e885";}.icon-QQ-circle-fill:before {  content: "\e887";}]]></content>
      
    </entry>
    
    
  
</search>
